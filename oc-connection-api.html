<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../oc-core-utils/oc-core-utils.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<dom-module id="oc-connection-api">

    <template>
        <iron-ajax id="getConnections"></iron-ajax>
        <iron-ajax id="getConnection"></iron-ajax>
        <iron-ajax id="getSettings"></iron-ajax>
        <iron-ajax id="getConnetionType"></iron-ajax>
        <iron-ajax id="updateSettings" method="put" content-type="application/json"></iron-ajax>
    </template>

    <script>
		class OcConnectionApi extends Ordercloud.ApiMixin(Polymer.Element) {
			static get is() {
				return 'oc-connection-api';
			}

			static get behaviours() {
			}

			/**
			 * Get all the connections for the specified organisation.
			 * @param {Number} organisationId
			 * @param {Object} [criteria]
			 * @param {String} [criteria.sort] - sort results by : fromOrganisation, toOrganisation, type (prepend + for ASC, - for DSC)
			 * @param {String[]} [criteria.statuses=['CONNECTED']] - The connection status (PENDING, CONNECTED, DECLINED)
			 * @param {(Number|String)} [criteria.type] - The connection type, id or code
			 * @param {Number} [criteria.page=1]
			 * @param {Number} [criteria.pageSize=-1]
			 * @param {Boolean} [criteria.showDisabled=false]
			 * @returns {Promise}
			 */
			getConnections(organisationId, criteria) {
				this.$.getConnections.url = this._generateUrl('connections/organisation/' + organisationId + '/status');
				this.$.getConnections.params = {
					sort: criteria.sort || [],
					type: criteria.type || [],
					page: criteria.page || 1,
					pagesize: criteria.pageSize || -1,
					showDisabled: criteria.showDisabled || false,
					connectionStatus: criteria.statuses || ['CONNECTED']
				};
				return this._generateRequest(this.$.getConnections);
			}

			/**
			 * Get connection
			 * @param {Number} id
			 * @returns {Promise}
			 */
			getConnection(id) {
				this.$.getConnection.url = this._generateUrl('connections/' + id);
				return this._generateRequest(this.$.getConnection);
			}

			/**
			 * Get connection
			 * @param {Number} id
			 * @returns {Promise}
			 */
			getConnectionsByType(id, typeCodeId) {
				this.$.getConnectionType.url = this._generateUrl('connections/' + id + 'organisations/connections/type/' + typeCodeId);
				return this._generateRequest(this.$.getConnectionType);
			}

			/**
			 * Get connection settings
			 * @param {Number} id
			 * @returns {Promise}
			 */
			getSettings(id) {
				this.$.getSettings.url = this._generateUrl('connections/' + id + '/settings');
				return this._generateRequest(this.$.getSettings);
			}

			/**
			 * Update connection settings
			 * @param {Number} id
			 * @param {Object[]} settings
			 * @param {String} settings[].value
			 * @param {String} settings[].settingKeyId
			 * @returns {Promise}
			 */
			updateSettings(id, settings) {
				this.$.updateSettings.url = this._generateUrl('connections/' + id + '/settings');
				this.$.updateSettings.body = settings;
				return this._generateRequest(this.$.updateSettings);
			}
		}

		window.customElements.define(OcConnectionApi.is, OcConnectionApi);
    </script>

</dom-module>
